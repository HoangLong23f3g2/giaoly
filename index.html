<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thư Viện Thuyết Giảng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .lecture-card:hover {
            border-color: #3b82f6;
            background-color: #f0f7ff;
            transition: all 0.2s ease;
        }
        .options-panel {
            transition: all 0.3s ease-out;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
        }
        .options-panel.show {
            max-height: 100px;
            opacity: 1;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }
        /* Hiệu ứng xoay icon khi mở danh mục */
        .chevron-icon {
            transition: transform 0.3s ease;
        }
        .rotate-90 {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900">

    <div class="max-w-3xl mx-auto p-4 md:p-10">
        <div class="mb-8">
            <h1 class="text-2xl font-extrabold text-slate-800 text-center md:text-left">Thư Viện Thuyết Giảng</h1>
            <div class="mt-4 relative">
                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                <input type="text" id="searchInput" placeholder="Tìm tên bài giảng..." 
                       class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
        </div>

        <div id="categoryContainer"></div>
    </div>

    <div id="modal" class="fixed inset-0 bg-slate-900/60 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 id="modalTitle" class="font-bold text-slate-800"></h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500"><i data-lucide="x"></i></button>
            </div>
            <div id="modalBody" class="p-6 overflow-y-auto text-slate-700 whitespace-pre-line leading-relaxed"></div>
            <div class="p-4 border-t flex justify-end">
                <button onclick="downloadDocx()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition">
                    <i data-lucide="download" class="w-4 h-4"></i> Tải .docx
                </button>
            </div>
        </div>
    </div>

    <script>
        const lectureData = [
					{
						categoryName: "Danh mục 1: Đạo Đức Học",
						lectures: [
							{
								name: "Bài 01: Lòng biết ơn cha mẹ...",
								transcript: `Nội dung bài 1...`,
								summary: "Tóm tắt bài 1...",
								link: "#"
							},
							
							{
								name: "Bài 02: Sự trung thực",
								transcript: `Nội dung bài 2...`,
								summary: "Tóm tắt bài 2...",
								link: "#"
							} // Không có dấu phẩy ở bài cuối cùng trong một danh mục
						]
					}, // PHẢI CÓ DẤU PHẨY Ở ĐÂY để ngăn cách giữa các danh mục
					{
						categoryName: "Danh mục 2",
						lectures: [
							{
								name: "Bài 01: Quản lý thời gian",
								transcript: `Nội dung về thời gian...`,
								summary: "Tóm tắt quản lý thời gian...",
								link: "https://youtube.com/..."
							},
							
							{
								name: "Bài 02: Sự trung thực",
								transcript: `Nội dung bài 2...`,
								summary: "Tóm tắt bài 2...",
								link: "#"
							} // Không có dấu phẩy ở bài cuối cùng trong một danh mục
						]
					}, // Dấu phẩy tiếp theo nếu còn danh mục thứ 3
					{
						categoryName: "Danh mục 3",
						lectures: [
							{
								name: "Bài 01: Truyền thống hiếu học",
								transcript: `Nội dung bài học...`,
								summary: "Tóm tắt bài học...",
								link: "#"
							},
							
							{
								name: "Bài 01: Truyền thống hiếu học",
								transcript: `Nội dung bài học...`,
								summary: "Tóm tắt bài học...",
								link: "#"
							},
						]
					}
		];

        // Hàm render chính
        function renderLectures(data, isSearching = false) {
            const container = document.getElementById('categoryContainer');
            container.innerHTML = '';

            data.forEach((category, catIndex) => {
                const catSection = document.createElement('div');
                catSection.className = 'mb-4 border-b border-slate-200 pb-2';
                
                // Header của danh mục (Click để đóng/mở)
                catSection.innerHTML = `
                    <div onclick="toggleCategory(${catIndex})" class="flex items-center justify-between cursor-pointer py-3 group">
                        <h2 class="text-sm font-bold text-slate-600 uppercase tracking-widest flex items-center gap-2 group-hover:text-blue-600 transition">
                            <i data-lucide="folder" class="w-4 h-4 text-blue-500"></i> ${category.categoryName} 
                            <span class="text-[10px] bg-slate-200 text-slate-500 px-2 py-0.5 rounded-full font-normal">${category.lectures.length}</span>
                        </h2>
                        <i data-lucide="chevron-right" id="icon-${catIndex}" class="chevron-icon w-5 h-5 text-slate-400 ${isSearching ? 'rotate-90' : ''}"></i>
                    </div>
                    <div id="cat-content-${catIndex}" class="space-y-3 mt-2 ${isSearching ? '' : 'hidden'}">
                        <div id="cat-list-${catIndex}" class="space-y-3 pb-4"></div>
                    </div>
                `;
                container.appendChild(catSection);

                const listContainer = document.getElementById(`cat-list-${catIndex}`);
                category.lectures.forEach((lec, lecIndex) => {
                    const lectureId = `lec-${catIndex}-${lecIndex}`;
                    const row = document.createElement('div');
                    row.className = 'lecture-card bg-white p-4 rounded-xl border border-slate-100 shadow-sm cursor-pointer ml-2 md:ml-6';
                    row.innerHTML = `
                        <div onclick="toggleOptions('${lectureId}')">
                            <div class="text-slate-800 font-medium leading-snug break-words">
                                ${lec.name}
                            </div>
                        </div>
                        <div id="${lectureId}" class="options-panel flex gap-4 md:gap-6 justify-start">
                            <button onclick="openModal('${lec.name} - Transcript', \`${lec.transcript}\`)" class="flex items-center gap-1.5 text-blue-600 font-medium text-xs hover:underline">
                                <i data-lucide="file-text" class="w-3.5 h-3.5"></i> Transcript
                            </button>
                            <button onclick="openModal('${lec.name} - Tóm tắt', \`${lec.summary}\`)" class="flex items-center gap-1.5 text-amber-600 font-medium text-xs hover:underline">
                                <i data-lucide="align-left" class="w-3.5 h-3.5"></i> Tóm tắt
                            </button>
                            <a href="${lec.link}" target="_blank" class="flex items-center gap-1.5 text-emerald-600 font-medium text-xs hover:underline">
                                <i data-lucide="external-link" class="w-3.5 h-3.5"></i> Link
                            </a>
                        </div>
                    `;
                    listContainer.appendChild(row);
                });
            });
            lucide.createIcons();
        }

        // Hàm đóng mở danh mục
        function toggleCategory(index) {
            const content = document.getElementById(`cat-content-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.add('rotate-90');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('rotate-90');
            }
        }

        function toggleOptions(id) {
            // Chỉ đóng các option khác trong cùng một danh mục hoặc toàn trang (tùy chọn)
            document.querySelectorAll('.options-panel').forEach(el => {
                if(el.id !== id) el.classList.remove('show');
            });
            document.getElementById(id).classList.toggle('show');
        }

        // --- Logic Modal & Download ---
        let currentTitle = "", currentContent = "";
        function openModal(title, content) {
            currentTitle = title; currentContent = content;
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalBody').innerText = content;
            document.getElementById('modal').classList.remove('hidden');
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        function downloadDocx() {
            const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'></head><body>";
            const footer = "</body></html>";
            const sourceHTML = header + "<h1>" + currentTitle + "</h1><p>" + currentContent.replace(/\n/g, '<br>') + "</p>" + footer;
            const blob = new Blob(['\ufeff', sourceHTML], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = currentTitle + '.doc';
            link.click();
        }

        // Logic Tìm kiếm: Tự động mở danh mục nếu có kết quả khớp
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase();
            if (term.trim() === "") {
                renderLectures(lectureData, false);
                return;
            }
            const filteredData = lectureData.map(cat => ({
                ...cat,
                lectures: cat.lectures.filter(lec => lec.name.toLowerCase().includes(term))
            })).filter(cat => cat.lectures.length > 0);
            
            renderLectures(filteredData, true);
        });

        // Khởi tạo ban đầu
        renderLectures(lectureData);
    </script>
</body>
</html>
